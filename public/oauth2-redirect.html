<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>OAuth2 Redirect</title>
  </head>
  <body>
    <script>
      // Parse the access token from the URL fragment and postMessage it to the opener window
      (function () {
        try {
          var hash = window.location.hash.substring(1);
          var params = {};
          hash.split('&').forEach(function (part) {
            var kv = part.split('=');
            if (kv[0]) params[kv[0]] = decodeURIComponent(kv[1] || '');
          });

          if (window.opener && params.access_token) {
            window.opener.postMessage({ type: 'oauth2_token', access_token: params.access_token, expires_in: params.expires_in }, window.location.origin);
          }
        } catch (e) {
          // ignore
        }
        // close the popup after a short delay
        setTimeout(function () { window.close(); }, 500);
      })();
    </script>
    <p>Authorization complete. You may close this window.</p>
  </body>
</html>
